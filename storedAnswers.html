<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø·ÙØ§Ù„</title>
    <link rel="stylesheet" href="style.css">
        <style>
        /* âœ… Ù†Ø¶Ø¨Ø· Ø§Ù„Ø¬Ø³Ù… Ù„ÙŠÙƒÙˆÙ† Ø¹Ù…ÙˆØ¯ÙŠ ÙˆÙŠÙ…ØªØ¯ Ø¹Ù„Ù‰ ÙƒØ§Ù…Ù„ Ø§Ù„Ø´Ø§Ø´Ø© */
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
    background: linear-gradient(to right, #4a7ab5, #229497, #24a148);
    color: white;
    display: flex;
    align-items: center;
    padding: 0 20px;
    position: relative;
    height: 80px; /* Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù‡ÙŠØ¯Ø± */
}

header img {
    height: 60px; /* Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© */
}

header h2 {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    margin: 0;
    text-align: center;
}


        main { 
            flex: 1; /* âœ… ÙŠØ®Ù„ÙŠ Ø§Ù„Ù…ÙŠÙ† ÙŠØªÙ…Ø¯Ø¯ ÙˆÙŠØ§Ø®Ø° Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙØ§Ø¶ÙŠØ© */
            display: flex;  
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow: auto;
        }

        footer{
            padding: 10px 40px;
            background: linear-gradient(to right, #4a7ab5, #229497, #24a148);
            width: 100%;
            text-align: left;
        }

        table {
            border-collapse: collapse;
            width: 80%;
            text-align: center;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
        }
    </style>
</head>

 
<body>
    <header>
    <h2>Ù†Ù…Ø·ÙŠ Ø´Ø®ØµÙŠØªÙŠ</h2>
    <img src="asses/logo.png" alt="Logo" width="80px">
</header>

    <main>
      <h1 style="text-align: center;">Ø¬Ø¯ÙˆÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø·ÙØ§Ù„</h1>
    <table>
        <thead>
            <tr>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                <th>Ù†Ù…Ø· Ø§Ù„ØªÙÙƒÙŠØ±</th>
                <th>Ø§Ù„ÙØµÙ„</th>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
            </tr>
        </thead>
        <tbody id="resultsTableBody">
            <tr><td colspan="5">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td></tr>
        </tbody>
    </table>
    <br />
    <button id="exportBtn">ØªØµØ¯ÙŠØ±</button>

    </main>

    <footer>
        <button id="Homebtn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© </button>

    </footer>
     

    <script type="module">
      document.addEventListener("DOMContentLoaded", () => {
    const Homebtn = document.getElementById("Homebtn");

    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø²Ø±
    if (Homebtn) {
        Homebtn.addEventListener("click", () => {
            // ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ ØµÙØ­Ø© "storedAnswers.html"
            window.location.href = "index.html";
        });
    } else {
        console.error("Ø§Ù„Ø²Ø± 'Homebtn' ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ØµÙØ­Ø©");
    }
});

        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB-FZIk3MoPegDHsmDDUzl5pYCzi4AnlEQ",
            authDomain: "studentpatterns.firebaseapp.com",
            projectId: "studentpatterns",
            storageBucket: "studentpatterns.firebasestorage.app",
            messagingSenderId: "533359813954",
            appId: "1:533359813954:web:909cbdcd20733ac6e994db"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadResults() {
            const tbody = document.getElementById("resultsTableBody");
            tbody.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø¯ÙŠÙ…

            try {
                const q = query(collection(db, "results"), orderBy("createdAt", "desc"));
                const snapshot = await getDocs(q);

                if (snapshot.empty) {
                    tbody.innerHTML = "<tr><td colspan='5'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</td></tr>";
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const answers = Array.isArray(data.answers) ? data.answers.join(", ") : "";
                    const date = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleString("ar-EG") : "";

                    const row = `<tr>
                        <td>${date}</td>
                        <td>${data.thinkingStyle || ""}</td>
                         <td>${data.desc || ""}</td>
                        <td>${data.name || ""}</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
            } catch (error) {
                console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
                tbody.innerHTML = "<tr><td colspan='5'>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>";
            }
        }

        loadResults();
    </script>
   <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø© Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
document.getElementById("exportBtn").addEventListener("click", () => {
    const table = document.querySelector("table");

    // Ø¥Ù†Ø´Ø§Ø¡ workbook Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ raw:true Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    const workbook = XLSX.utils.table_to_book(table, { 
        sheet: "Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø·ÙØ§Ù„",
        raw: true
    });

    const worksheet = workbook.Sheets["Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø·ÙØ§Ù„"];
    const range = XLSX.utils.decode_range(worksheet["!ref"]);

    // ğŸŸ¢ Ø¶Ø¨Ø· Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø§Ù… Ù„ÙƒÙ„ Ø§Ù„Ø®Ù„Ø§ÙŠØ§
    for (let R = range.s.r; R <= range.e.r; ++R) {
        for (let C = range.s.c; C <= range.e.c; ++C) {
            const cellAddress = XLSX.utils.encode_cell({ r: R, c: C });
            const cell = worksheet[cellAddress];
            if (!cell) continue;

            // Ù…Ù†Ø¹ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ù„ØªØ§Ø±ÙŠØ®
            if (typeof cell.v === "string" && cell.v.includes("/")) {
                cell.t = "s";
                cell.v = "'" + cell.v;
            }

            // ğŸ”¹ ØªÙ„ÙˆÙŠÙ† Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            if (R === 0) {
                cell.s = {
                    fill: { fgColor: { rgb: "24A148" } },
                    font: { bold: true, color: { rgb: "FFFFFF" }, name: "Cairo", sz: 13 },
                    alignment: { horizontal: "center", vertical: "center", wrapText: true },
                    border: {
                        top: { style: "thin", color: { rgb: "CCCCCC" } },
                        bottom: { style: "thin", color: { rgb: "CCCCCC" } },
                        left: { style: "thin", color: { rgb: "CCCCCC" } },
                        right: { style: "thin", color: { rgb: "CCCCCC" } }
                    }
                };
            } 
            // ğŸ”¹ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙÙˆÙ
            else {
                cell.s = {
                    fill: { fgColor: { rgb: R % 2 === 0 ? "F5F9F6" : "FFFFFF" } },
                    font: { color: { rgb: "000000" }, name: "Cairo", sz: 12 },
                    alignment: { horizontal: "center", vertical: "center", wrapText: true },
                    border: {
                        top: { style: "thin", color: { rgb: "E4E4E4" } },
                        bottom: { style: "thin", color: { rgb: "E4E4E4" } },
                        left: { style: "thin", color: { rgb: "E4E4E4" } },
                        right: { style: "thin", color: { rgb: "E4E4E4" } }
                    }
                };
            }
        }
    }

    // âœ¨ ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© (Ø­ØªÙ‰ ÙŠØ¨Ø§Ù† Ø§Ù„Ù†Øµ ÙƒØ§Ù…Ù„)
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„: Ø§Ù„ØªØ§Ø±ÙŠØ® - Ø§Ù„Ù†Ù…Ø· - Ø§Ù„ÙØµÙ„ - Ø§Ù„Ø§Ø³Ù…
    worksheet["!cols"] = [
        { wch: 22 }, // ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        { wch: 20 }, // Ù†Ù…Ø· Ø§Ù„ØªÙÙƒÙŠØ±
        { wch: 15 }, // Ø§Ù„ÙØµÙ„
        { wch: 25 }  // Ø§Ù„Ø§Ø³Ù…
    ];

    // âœ¨ Ø²ÙŠØ§Ø¯Ø© Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØµÙÙˆÙ Ù‚Ù„ÙŠÙ„Ø§Ù‹
    const rowHeights = [];
    for (let R = range.s.r; R <= range.e.r; ++R) {
        rowHeights.push({ hpt: R === 0 ? 24 : 20 }); // Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£Ø¹Ù„Ù‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹
    }
    worksheet["!rows"] = rowHeights;

    // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    XLSX.writeFile(workbook, "Ù†ØªØ§Ø¦Ø¬_Ø§Ù„Ø£Ø·ÙØ§Ù„.xlsx");
});
</script>


</body>
</html>


